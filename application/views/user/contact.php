<section class="inner_page_head">
	<div class="container_fuild">
		<div class="row">
			<div class="col-md-12">
				<div class="full">
					<h3>Contact</h3>
				</div>
			</div>
		</div>
	</div>
</section>

<section class="why_section layout_padding">
	<div class="container">
		<div class="row">
			<div class="col-sm-12 col-md-12">
				<div class="mapouter">
					<div class="gmap_canvas">
						<iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3960.2305463814387!2d108.47777867454178!3d-6.98209846837234!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2e6f142e9e690689%3A0x1f9e7d741164b80c!2sJl.%20Ps.%20Kepuh%2C%20Kuningan%2C%20Kec.%20Kuningan%2C%20Kabupaten%20Kuningan%2C%20Jawa%20Barat%2045511!5e0!3m2!1sid!2sid!4v1687451980589!5m2!1sid!2sid" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
						<a href="https://technologg.com/" style="display:none">technologg</a>
						<style>.mapouter{position:relative;text-align:right;height:400px;width:100%;}</style>
						<style>.gmap_canvas{overflow:hidden;background:none!important;height:400px;width:100%;}</style>
					</div>
				</div>
			</div>
		</div>
		<div class="row align-items-stretch mb-5">
			<div class="col-md-8">
				<div class="box h-100">
					<div class="img-box">
						<i class="fa fa-home" style="font-size: 100px;"></i>
					</div>
					<div class="detail-box text-center">
						<h5>
							Alamat Wardani Collection
						</h5>
						<p class="text-center">
							Komplek Pasar Kepuh Blok C No.11 Kabupaten Kuningan
						</p>
					</div>
				</div>
			</div>
			<div class="col-md-4">
				<div class="box h-100">
					<div class="img-box">
						<i class="fa fa-whatsapp" style="font-size: 100px"></i>
					</div>
					<div class="detail-box">
						<h5>
							Whatsapp
						</h5>
						<p>
							<a href="https://wa.me/+6283824587800" target="_blank">083824587800</a>
						</p>
					</div>
				</div>
			</div>
			<!-- <div class="col-md-4">
				<div class="box ">
					<div class="img-box">
						<svg id="_30_Premium" height="512" viewBox="0 0 512 512" width="512" xmlns="http://www.w3.org/2000/svg" data-name="30_Premium">
							<g id="filled">
								<path d="m252.92 300h3.08a124.245 124.245 0 1 0 -4.49-.09c.075.009.15.023.226.03.394.039.789.06 1.184.06zm-96.92-124a100 100 0 1 1 100 100 100.113 100.113 0 0 1 -100-100z" />
								<path d="m447.445 387.635-80.4-80.4a171.682 171.682 0 0 0 60.955-131.235c0-94.841-77.159-172-172-172s-172 77.159-172 172c0 73.747 46.657 136.794 112 161.2v158.8c-.3 9.289 11.094 15.384 18.656 9.984l41.344-27.562 41.344 27.562c7.574 5.4 18.949-.7 18.656-9.984v-70.109l46.6 46.594c6.395 6.789 18.712 3.025 20.253-6.132l9.74-48.724 48.725-9.742c9.163-1.531 12.904-13.893 6.127-20.252zm-339.445-211.635c0-81.607 66.393-148 148-148s148 66.393 148 148-66.393 148-148 148-148-66.393-148-148zm154.656 278.016a12 12 0 0 0 -13.312 0l-29.344 19.562v-129.378a172.338 172.338 0 0 0 72 0v129.38zm117.381-58.353a12 12 0 0 0 -9.415 9.415l-6.913 34.58-47.709-47.709v-54.749a171.469 171.469 0 0 0 31.467-15.6l67.151 67.152z" />
								<path d="m287.62 236.985c8.349 4.694 19.251-3.212 17.367-12.618l-5.841-35.145 25.384-25c7.049-6.5 2.89-19.3-6.634-20.415l-35.23-5.306-15.933-31.867c-4.009-8.713-17.457-8.711-21.466 0l-15.933 31.866-35.23 5.306c-9.526 1.119-13.681 13.911-6.634 20.415l25.384 25-5.841 35.145c-1.879 9.406 9 17.31 17.367 12.618l31.62-16.414zm-53-32.359 2.928-17.615a12 12 0 0 0 -3.417-10.516l-12.721-12.531 17.658-2.66a12 12 0 0 0 8.947-6.5l7.985-15.971 7.985 15.972a12 12 0 0 0 8.947 6.5l17.658 2.66-12.723 12.535a12 12 0 0 0 -3.417 10.516l2.928 17.615-15.849-8.231a12 12 0 0 0 -11.058 0z" />
							</g>
						</svg>
					</div>
					<div class="detail-box">
						<h5>
							Best Quality
						</h5>
						<p>
							variations of passages of Lorem Ipsum available
						</p>
					</div>
				</div>
			</div> -->
		</div>

		<div class="row">
			<div class="col-sm-12 col-md-12">
				<div class="box">
					<div class="row">
						<div class="col-sm-12 col-md-4">
							<div class="input-group mb-3">
								<input id="nama_lengkap_contact" type="text" class="form-control" placeholder="Nama Lengkap" aria-label="Nama Lengkap" aria-describedby="basic-addon1">
							</div>
							<div class="input-group mb-3">
								<input id="nowacontact" type="text" class="form-control" placeholder="No. Whatsapp ( +6283824587800 )" aria-label="No. Whatsapp" aria-describedby="basic-addon1">
							</div>
							<div class="input-group mb-3">
								<input id="subjekcontact" type="text" class="form-control" placeholder="Subjek" aria-label="Subjek" aria-describedby="basic-addon1">
							</div>
						</div>
						<div class="col-sm-12 col-md-8">
							<div class="input-group mb-3">
								<textarea name="message" id="message" class="form-control" placeholder="Masukan Pesan" aria-describedby="basic-addon1" cols="30" rows="5"></textarea>
							</div>
						</div>

					</div>
					<!-- <button type="submit" id="btn_send" class="btn btn-primary w-100" style="display: none"></button> -->
					<a id="btn_send" target="_blank" href="#!" class="btn btn-primary" style="display: none">Send <i class="fa fa-send"></i></a>

				</div>
			</div>
		</div>
	</div>
</section>

<script type="text/javascript">
	let nama_lengkap = document.querySelector("#nama_lengkap_contact")
	let nowa = document.querySelector("#nowacontact")
	let subjek = document.querySelector("#subjekcontact")
	let message = document.querySelector("#message")

	let btn = document.querySelector("#btn_send")

	let dataContact = []

	nama_lengkap.addEventListener("change", () => {
		dataContact[0] = nama_lengkap.value
		if (checkVarDataUser()) {
			btn.style.display = "block"
		}
	})

	nowa.addEventListener("change", () => {
		dataContact[1] = nowa.value
		if(checkVarDataUser()){
			btn.style.display = "block"
		}
	})

	subjek.addEventListener("change", () => {
		dataContact[2] = subjek.value
		if (checkVarDataUser()) {
			btn.style.display = "block"
		}
	})

	message.addEventListener("change", () => {
		dataContact[3] = message.value
		if(checkVarDataUser()){
			btn.style.display = "block"
		}
	})


	function checkVarDataUser(){
		if(dataContact[0] != null && dataContact[1] != null && dataContact[2] != null && dataContact[3] != null){
			btn.setAttribute("href", "https://api.whatsapp.com/send?phone=6283824587800&text=Hallo Kak saya "+nama_lengkap.value+" ingin mengajukan "+subjek.value+" terhadap cemilannya "+message.value)
			return true;
		}else{
			return false;
		}
	}

	$(document).ready(function(){
		$('#dataproduk').click(function(){
			var product_id    = $(this).data("idproduk");
			var product_name  = $(this).data("namaproduk");
			var product_price = $(this).data("hargaproduk");
			var quantity      = $("#jml_pesan").val();
			var stok 		  = $(this).data("stok")
			console.log(stok)
			if(parseInt($("#jml_pesan").val()) != -1 && parseInt($("#jml_pesan").val()) != 0){
				if ($("#jml_pesan").val() <= parseInt(stok)) {
					$.ajax({
						url : "<?= site_url('add_to_cart');?>",
						method : "POST",
						data : {
							product_id: product_id, 
							product_name: product_name, 
							product_price: product_price,
							quantity: quantity
						},
						success: function(data){
							$('#tbody').html(data);
							alert("Berhasil ditambahkan ke keranjang")
						}
					});
				}else{
					alert("Maaf anda ngece yaa, Stokan cuma ada: "+stok)
				}
				
			}else{
				alert("Niat beli ga cok!, isi ko minus/ nol badjingan")
			}

		});

		$('#tbody').load("<?php echo site_url('load_cart');?>");

		$(document).on('click','.hapus_cart',function(){
			var row_id=$(this).attr("id"); 
			$.ajax({
				url : "<?php echo site_url('delete_cart');?>",
				method : "POST",
				data : {row_id : row_id},
				success :function(data){
					$('#tbody').html(data);
				}
			});
		});

		$(document).on("change", ".product_qty", function(){
			$.ajax({
				url : "<?php echo site_url('update_cart');?>",
				method : "POST",
				data : {
					row_id : $(this).data("rowid"),
					qty: $(this).val()
				},
				success :function(data){
					$('#tbody').html(data);
				}
			});
		})

		$("#btn_send_wa").click(()=>{
      let _data = []
      let uuid_co = rand(10)
      let alamat_penerima = $("#alamat_pemesan").val()
      let no_telp = $("#info_modal_no_penerima").html()
      let srcPembayaran = document.querySelector("#buktiInputPembayaran")
      $.map($("#data_table_tr > #data_table_text_product"), function (elem, index){
         _data[index] = {
            id_barang: elem.getAttribute("data-id_produk"),
            product: elem.getAttribute("data-textproduct"),
            banyak: elem.getAttribute("data-banyakproduk"),
            harga: elem.getAttribute("data-hargaperitem"),
            image: elem.getAttribute("data-image"),
            ukuran: elem.getAttribute("data-ukuran"),
            model: elem.getAttribute("data-model"),
            bahan: elem.getAttribute("data-bahan"),
            provinsi: $("#provinsi").data("provinsi"),
            kota: $("#kota").data("kota"),
            ekspedisi: $("#ekspedisi").data("ekspedisi"),
            ongkir: $("#ongkir").data("ongkir")
         }
      })

      console.log(_data)

      let data = JSON.stringify(_data)

      sendData(uuid_co, data, alamat_penerima, no_telp, srcPembayaran)

   })
   

   function sendData(uuid_co, _data, alamat_penerima, no_telp, srcPembayaran) {
      var xhr = new XMLHttpRequest();
      var url = "http://localhost/app/co/";

      let form = new FormData()

      form.append("uuid", uuid_co)
      form.append("data", _data)
      form.append("alamat", alamat_penerima)
      form.append("no_telp", no_telp)
      // form.append("gambarPembayaran", srcPembayaran.files)
      jQuery.each(jQuery('#buktiInputPembayaran')[0].files, function(i, file) {
          form.append('gambarPembayaran', file);
      });

      let formData = new FormData();
      fetch('http://localhost/app/co/', {
          method:"POST",
          body: form
      })
      .then(response =>{
          response.text()
          .then(data => {
               let alertData = data
               if(alertData == "tidak bisa checkout karena stok terbatastrue"){
                  let newAlert = alertData.substring(0, alertData.indexOf("true"));
                  alert(newAlert)
                  location.reload()
               }
               if(data == true || data == "true"){
                  let id_userss = "<?= $this->session->userdata('user_logged')['id_user'] ?>"
                  if(id_userss != null || id_userss != "" || id_userss != 0){
                     window.location.replace("<?= base_url('riwayat/'.$this->session->userdata('user_logged')['id_user']) ?>")
                  }else{
                     alert("Silahkan login terlebih dahulu")
                  }
               }
          })
      })

      return false;
  }

   const rupiah = (number)=>{
     return new Intl.NumberFormat("id-ID", {
      style: "currency",
      currency: "IDR"
    }).format(number);
   }

  const rand = length => {
      let result = '';
      const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      const charactersLength = characters.length;
      let counter = 0;
      while (counter < length) {
         result += characters.charAt(Math.floor(Math.random() * charactersLength));
         counter += 1;
      }
      return result;
  }

	})
</script>